<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime Admin Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#0f172a;
  color:#fff;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:230px;
  background:#111827;
  padding:20px;
  height:100vh;
}
.sidebar h2{
  color:#22d3ee;
}
.sidebar a{
  display:block;
  color:#94a3b8;
  margin:15px 0;
  text-decoration:none;
}

/* MAIN */
.main{
  flex:1;
  padding:20px;
}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin-bottom:20px;
}

.card{
  background:#1e293b;
  padding:20px;
  border-radius:16px;
}

.big{
  font-size:26px;
  font-weight:bold;
}

.panel{
  background:#1e293b;
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}

/* TOP 10 */
.top-item{
  display:flex;
  gap:12px;
  padding:12px 0;
  border-bottom:1px solid #334155;
  align-items:center;
}

.rank{
  font-size:20px;
  width:30px;
  text-align:center;
}

.cover{
  width:50px;
  height:70px;
  object-fit:cover;
  border-radius:8px;
}

.progress{
  height:6px;
  background:#334155;
  border-radius:6px;
  overflow:hidden;
  margin-top:6px;
}

.progress div{
  height:100%;
  background:#22d3ee;
  width:0%;
}
select{
  padding:6px;
  border-radius:8px;
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>ğŸ› Admin</h2>
  <a href="#">Dashboard</a>
</div>

<div class="main">

<!-- CARDS -->
<div class="cards">
  <div class="card">
    <div>ğŸ‘€ à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ</div>
    <div class="big" id="onlineCount">0</div>
  </div>

  <div class="card">
    <div>ğŸ“ˆ à¸§à¸´à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</div>
    <div class="big" id="totalViews">0</div>
  </div>

  <div class="card">
    <div>ğŸ¬ à¸ˆà¸³à¸™à¸§à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡</div>
    <div class="big" id="totalAnime">0</div>
  </div>
</div>

<!-- CHART -->
<div class="panel">
  <h3>ğŸ“Š à¸§à¸´à¸§à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</h3>
  <canvas id="viewChart" height="100"></canvas>
</div>

<!-- TOP 10 -->
<div class="panel">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h3>ğŸ† Top 10</h3>
    <select id="rangeSelect">
      <option value="all">à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</option>
      <option value="7">7 à¸§à¸±à¸™</option>
      <option value="30">30 à¸§à¸±à¸™</option>
    </select>
  </div>
  <div id="topList"></div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase,
  ref,
  onValue
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "PROJECT",
  storageBucket: "PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ================= ONLINE USERS ================= */
onValue(ref(db,"onlineUsers"), snap=>{
  const count = snap.exists() ? Object.keys(snap.val()).length : 0;
  document.getElementById("onlineCount").textContent = count;
});

/* ================= TOTAL VIEWS ================= */
onValue(ref(db,"stats/totalViews"), snap=>{
  document.getElementById("totalViews").textContent =
    snap.exists() ? snap.val() : 0;
});

/* ================= TOTAL ANIME ================= */
onValue(ref(db,"animeList"), snap=>{
  const total = snap.exists() ? Object.keys(snap.val()).length : 0;
  document.getElementById("totalAnime").textContent = total;
});

/* ================= TOP 10 ================= */
const topList = document.getElementById("topList");

onValue(ref(db,"animeViews"), snap=>{
  if(!snap.exists()) return;

  const data = snap.val();
  const arr = Object.entries(data);

  arr.sort((a,b)=> b[1] - a[1]);

  const top10 = arr.slice(0,10);
  const max = top10[0] ? top10[0][1] : 1;

  topList.innerHTML = "";

  top10.forEach(([id,views],i)=>{

    const percent = (views/max)*100;

    const medal =
      i===0 ? "ğŸ¥‡" :
      i===1 ? "ğŸ¥ˆ" :
      i===2 ? "ğŸ¥‰" :
      "#"+(i+1);

    topList.innerHTML += `
      <div class="top-item">
        <div class="rank">${medal}</div>
        <div style="flex:1">
          <div style="font-weight:bold">${id}</div>
          <div style="font-size:13px;color:#94a3b8">${views} à¸§à¸´à¸§</div>
          <div class="progress">
            <div style="width:${percent}%"></div>
          </div>
        </div>
      </div>
    `;
  });
});

</script>
</body>
</html>