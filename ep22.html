<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>DarkFrame Watch</title<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>DarkFrame Watch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

player video {
  width: 100%;
  max-height: 100vh;
  background: #000;
  object-fit: cover;
}

body{
  margin:0;
  min-height:100vh;
  font-family:sans-serif;
  background:
    url("https://img.freepik.com/free-photo/anime-night-sky-illustration_23-2151684372.jpg")
    center / cover no-repeat fixed;
  color:#fff;
}

.title{
  background:#fff;
  color:#000;
  padding:12px 16px;
  border-radius:12px;
  margin:12px;
  font-size:18px;
  font-weight:700;
}

.top-title{
  background:rgba(0,0,0,.85);
  color:#fff;
  padding:14px;
  border-radius:14px;
  margin:12px;
  text-align:center;
}

.stats{
  margin:12px;
  background:rgba(0,0,0,.7);
  border-radius:12px;
  padding:12px;
  display:flex;
  gap:16px;
  justify-content:center;
}

.player{
  max-width:720px;
  margin:12px auto;
  background:#000;
  border-radius:14px;
  overflow:hidden;
}

.player video{
  width:100%;
  aspect-ratio:16/9;
  object-fit:contain;
}

.controls{
  display:flex;
  gap:10px;
  margin:12px;
}

.btn{
  flex:1;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#1e1e1e;
  color:#fff;
  cursor:pointer;
}

.btn:hover{background:#ff4d4d}
.like{background:#ff4d4d}
</style>
</head>

<body
  data-anime="Kusuriya no Hitorigoto ‡∏™‡∏∑‡∏ö‡∏Ñ‡∏î‡∏µ‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤ ‡∏´‡∏°‡∏≠‡∏¢‡∏≤‡∏ï‡∏≥‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏°‡πÅ‡∏î‡∏á
  data-ep="22"
>

<div class="title">
  Kusuriya no Hitorigoto ‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 22
  
  </span>
</div>

<div class="top-title">
  ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ï‡∏≠‡∏ô 1‚Äì24 
</div>

<div class="stats">
  üëÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π: <b id="watchingNow">0</b>
  ‚ù§Ô∏è ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à: <b id="likeCount">0</b>
</div>

<div class="player">
    <video
    id="videoPlayer"
    controls
    playsinline
    poster="https://pbs.twimg.com/media/DSJGh_9U8AAzf_Q.jpg">
    <source src="https://main.108player.com/m3u8/82cdb32263ba3fc988bd3df7/82cdb32263ba3fc988bd3df7168.m3u8">
  </video>

  </div>

<div class="controls">
  <button class="btn" onclick="prevEp()">‚¨Ö ‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <button class="btn" onclick="showAllEp()">‚ò∞ ‡∏ï‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  <button class="btn" onclick="nextEp()">‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°</button>
</div>

<!-- ===== FIREBASE ===== -->
<script src="firebase.js"></script>
<script>
/* ================= BASIC ================= */
const anime = document.body.dataset.anime;
const ep    = Number(document.body.dataset.ep);
const total = Number(document.body.dataset.total);
epShow.textContent = ep;

/* ================= LOCAL PROGRESS ================= */
let dbLocal = JSON.parse(localStorage.getItem("animeDB")) || {};
if(!dbLocal[anime]){
  dbLocal[anime] = { total, done: [] };
}
if(!dbLocal[anime].done.includes(ep)){
  dbLocal[anime].done.push(ep);
}
localStorage.setItem("animeDB", JSON.stringify(dbLocal));

/* ================= FIREBASE ================= */

// üëÄ ‡∏Ñ‡∏ô‡∏î‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
const watchRef = db.ref("watching/"+anime).push(true);
watchRef.onDisconnect().remove();

db.ref("watching/"+anime).on("value", s=>{
  watchingNow.textContent = s.numChildren();
});

// üî¢ ‡∏¢‡∏≠‡∏î‡∏î‡∏π‡∏™‡∏∞‡∏™‡∏° (‡∏ô‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤)
db.ref("views/anime/"+anime).transaction(v => (v||0)+1);

db.ref("likes/"+anime).on("value", s=>{
  likeCount.textContent = s.val() || 0;
});

/* ================= CHANGE EP ================= */
function prevEp(){
  location.href = "ep21.html";
}


function nextEp(){
  location.href = "ep23.html";
}

function showAllEp(){
  location.href = "DarkFrame.html";
}
</script>

</body>
</html>