<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Admin Dashboard</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:system-ui
}
header{
  padding:12px 16px;
  background:#111;
  display:flex;
  justify-content:space-between;
  align-items:center
}
.stat{display:flex;gap:16px;font-size:14px}
.box{
  background:#151515;
  border-radius:12px;
  padding:16px;
  margin:16px
}
h3{margin-top:0;color:#00ffcc}
.anime-card{
  display:flex;
  gap:12px;
  margin-bottom:12px;
  background:#1a1a1a;
  border-radius:10px;
  padding:8px
}
.anime-card img{
  width:60px;
  height:80px;
  object-fit:cover;
  border-radius:6px
}
button{
  background:#00ffcc;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer
}
button.hide{background:#ff5555;color:#fff}
button.restore{background:#55ff77}

#notifyBox{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#00ffcc;
  color:#000;
  width:48px;
  height:48px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  cursor:pointer
}
#notifyCount{
  position:absolute;
  top:-6px;
  right:-6px;
  background:red;
  color:#fff;
  width:22px;
  height:22px;
  border-radius:50%;
  font-size:12px;
  display:flex;
  align-items:center;
  justify-content:center
}
#inbox{
  position:fixed;
  right:20px;
  bottom:80px;
  width:300px;
  max-height:400px;
  overflow:auto;
  background:#111;
  border-radius:12px;
  padding:12px;
  display:none
}
.report-item{
  background:#1a1a1a;
  border-radius:8px;
  padding:8px;
  margin-bottom:8px;
  font-size:13px
}
input{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:none;
  margin-bottom:12px
}
</style>
</head>

<body>

<header>
  <b>üõ† Admin Dashboard</b>
  <div class="stat">
    üü¢ <span id="onlineCount">0</span>
    üëÅ <span id="views">0</span>
    üìö <span id="animeCount">0</span>
  </div>
</header>

<div class="box">
  <h3>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞</h3>
  <input id="search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠...">
  <div id="animeList"></div>
</div>

https://www.pngarts.com/files/8/Cute-Anime-Transparent-Images.png

<div class="box">
  <h3>üóë ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô</h3>
  <div id="hiddenList"></div>
</div>

<!-- üîî NOTIFY -->
<div id="notifyBox" onclick="toggleInbox()">
  üîî
  <div id="notifyCount">0</div>
</div>

<!-- üì¨ INBOX -->
<div id="inbox">
  <h3>üì¨ ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h3>
  <div id="reportList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref,
  onValue, onChildAdded, onChildChanged,
  get, set, remove, update
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig={
  apiKey:"API_KEY",
  authDomain:"PROJECT.firebaseapp.com",
  databaseURL:"https://PROJECT-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"PROJECT",
  appId:"APP_ID"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* DOM */
const onlineCount=document.getElementById("onlineCount");
const views=document.getElementById("views");
const animeCount=document.getElementById("animeCount");
const animeList=document.getElementById("animeList");
const hiddenList=document.getElementById("hiddenList");
const search=document.getElementById("search");
const inbox=document.getElementById("inbox");
const reportList=document.getElementById("reportList");
const notifyCount=document.getElementById("notifyCount");

/* TOGGLE */
window.toggleInbox=()=>{
  inbox.style.display=inbox.style.display==="block"?"none":"block";
};

/* üîî REPORT REALTIME */
let unread=0, seen={};

onChildAdded(ref(db,"reports"),snap=>{
  const d=snap.val();
  if(!d||seen[snap.key])return;
  seen[snap.key]=true;

  if(!d.read){
    unread++;
    notifyCount.textContent=unread;
    new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3").play();
  }

  const div=document.createElement("div");
  div.className="report-item";
  div.id="r-"+snap.key;
  div.innerHTML=`
    <b>${d.page||""}</b><br>
    ${d.detail||""}<br>
    <small>${d.time||""}</small><br>
    ${!d.read?`<button onclick="markRead('${snap.key}')">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>`:""}
  `;
  reportList.prepend(div);
});

onChildChanged(ref(db,"reports"),snap=>{
  const el=document.getElementById("r-"+snap.key);
  if(el){
    el.style.opacity=.5;
    el.querySelector("button")?.remove();
    unread=Math.max(0,unread-1);
    notifyCount.textContent=unread;
  }
});

window.markRead=k=>{
  update(ref(db,"reports/"+k),{read:true});
};

/* üü¢ ONLINE */
onValue(ref(db,"onlineUsers"),s=>{
  onlineCount.textContent=s.exists()?Object.keys(s.val()).length:0;
});

/* üëÅ VIEWS */
onValue(ref(db,"animeViews"),s=>{
  views.textContent=s.val()||0;
});

/* üìö ANIME */
let cache=[];
onValue(ref(db,"animeList"),s=>{
  if(!s.exists())return;
  cache=Object.entries(s.val());
  animeCount.textContent=cache.length;
  render(cache);
});

function render(list){
  animeList.innerHTML="";
  list.forEach(([id,a])=>{
    animeList.innerHTML+=`
      <div class="anime-card">
        <img src="${a.cover||''}">
        <div>
          <b>${a.title}</b><br>
          üëÅ ${a.views||0}<br>
          <button class="hide" onclick="hideAnime('${id}')">‡∏ã‡πà‡∏≠‡∏ô</button>
        </div>
      </div>`;
  });
}

search.oninput=()=>{
  const q=search.value.toLowerCase();
  render(cache.filter(([_,a])=>a.title.toLowerCase().includes(q)));
};

/* üóë HIDE / RESTORE */
window.hideAnime=async id=>{
  const s=await get(ref(db,"animeList/"+id));
  await set(ref(db,"hiddenAnime/"+id),s.val());
  await remove(ref(db,"animeList/"+id));
};

onValue(ref(db,"hiddenAnime"),s=>{
  hiddenList.innerHTML="";
  if(!s.exists())return;
  Object.entries(s.val()).forEach(([id,a])=>{
    hiddenList.innerHTML+=`
      <div class="report-item">
        <b>${a.title}</b><br>
        <button class="restore" onclick="restoreAnime('${id}')">‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</button>
      </div>`;
  });
});

window.restoreAnime=async id=>{
  const s=await get(ref(db,"hiddenAnime/"+id));
  await set(ref(db,"animeList/"+id),s.val());
  await remove(ref(db,"hiddenAnime/"+id));
};
</script>

</body>
</html>