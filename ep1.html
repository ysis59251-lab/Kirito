<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>DarkFrame Watch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  min-height:100vh;
  font-family:sans-serif;
  background:
    url("https://img.freepik.com/free-photo/anime-night-sky-illustration_23-2151684372.jpg")
    center / cover no-repeat fixed;
  color:#fff;
}

.title{
  background:#fff;
  color:#000;
  padding:12px 16px;
  border-radius:12px;
  margin:12px;
  font-size:18px;
  font-weight:700;
}

.top-title{
  background:rgba(0,0,0,.85);
  color:#fff;
  padding:14px;
  border-radius:14px;
  margin:12px;
  text-align:center;
}

.stats{
  margin:12px;
  background:rgba(0,0,0,.7);
  border-radius:12px;
  padding:12px;
  display:flex;
  gap:16px;
  justify-content:center;
}

.player{
  max-width:720px;
  margin:12px auto;
  background:#000;
  border-radius:14px;
  overflow:hidden;
}

.player iframe,
.player video{
  width:100%;
  aspect-ratio:16/9;
  border:none;
  background:#000;
}

.controls{
  display:flex;
  gap:10px;
  margin:12px;
}

.btn{
  flex:1;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#1e1e1e;
  color:#fff;
  cursor:pointer;
}
.btn:hover{background:#ff4d4d}
</style>
</head>

<body>

<div class="title" id="titleText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

<div class="top-title" id="topText">‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ï‡∏≠‡∏ô</div>

<div class="stats">
  üëÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π: <b id="watchingNow">-</b>
</div>

<div class="player" id="playerArea">
  <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏∞‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
</div>

<div class="controls">
  <button class="btn" onclick="prevEp()">‚¨Ö ‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
  <button class="btn" onclick="showAllEp()">‚ò∞ ‡∏ï‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  <button class="btn" onclick="nextEp()">‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°</button>
</div>

<script>
/* ================= CONFIG ================= */
const SHEET_ID = "1r2QhYu826ZomrOOAOmAjsHfWv17aVmnBFylaeKnfsU8";
const SHEET_URL =
`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

// ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL
const params = new URLSearchParams(location.search);
const anime = params.get("anime");
let ep = Number(params.get("ep") || 1);

let episodes = [];

/* ================= LOAD SHEET ================= */
fetch(SHEET_URL)
.then(r=>r.text())
.then(t=>{
  const json = JSON.parse(t.substring(47).slice(0,-2));
  json.table.rows.forEach(r=>{
    if(r.c[0]?.v === anime){
      episodes.push({
        ep: r.c[1].v,
        title: r.c[2]?.v || "",
        url: r.c[3].v
      });
    }
  });
  init();
});

function init(){
  if(!episodes.length){
    document.getElementById("playerArea").innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
    return;
  }

  const current = episodes.find(e=>e.ep === ep) || episodes[0];
  ep = current.ep;

  document.getElementById("titleText").innerText =
    `${anime} ‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${ep}`;

  document.getElementById("topText").innerText =
    `‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ï‡∏≠‡∏ô ${episodes[0].ep} ‚Äì ${episodes[episodes.length-1].ep}`;

  showVideo(current.url);
}

/* ================= VIDEO ================= */
function showVideo(url){
  const area = document.getElementById("playerArea");
  area.innerHTML = "";

  if(url.includes("youtube") || url.includes("drive.google")){
    area.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
  }else{
    area.innerHTML = `<video controls playsinline src="${url}"></video>`;
  }
}

/* ================= NAV ================= */
function prevEp(){
  const i = episodes.findIndex(e=>e.ep === ep);
  if(i > 0){
    location.search = `?anime=${anime}&ep=${episodes[i-1].ep}`;
  }
}

function nextEp(){
  const i = episodes.findIndex(e=>e.ep === ep);
  if(i < episodes.length-1){
    location.search = `?anime=${anime}&ep=${episodes[i+1].ep}`;
  }
}

function showAllEp(){
  location.href = "index.html?anime="+anime;
}
</script>

</body>
</html>