<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnimeFume Admin</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#0f172a;
  color:#fff;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:230px;
  background:#111827;
  padding:20px;
  height:100vh;
}
.sidebar h2{
  color:#22d3ee;
}
.sidebar a{
  display:block;
  color:#94a3b8;
  margin:15px 0;
  text-decoration:none;
}

/* MAIN */
.main{
  flex:1;
  padding:20px;
  overflow-y:auto;
}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin-bottom:20px;
}

.card{
  background:#1e293b;
  padding:20px;
  border-radius:16px;
}

.big{
  font-size:26px;
  font-weight:bold;
}

.panel{
  background:#1e293b;
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}

.top-item{
  display:flex;
  gap:12px;
  padding:12px 0;
  border-bottom:1px solid #334155;
  align-items:center;
}

.rank{
  font-size:20px;
  width:30px;
  text-align:center;
}

.progress{
  height:6px;
  background:#334155;
  border-radius:6px;
  overflow:hidden;
  margin-top:6px;
}

.progress div{
  height:100%;
  background:#22d3ee;
}

.spam-box{
  background:#300;
  padding:15px;
  border-radius:12px;
  margin-bottom:20px;
  color:#ff4d4d;
}
button{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.clear-btn{
  background:#ff3b3b;
  color:#fff;
  margin-top:10px;
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>üéõ Admin</h2>
  <a href="#">Dashboard</a>
</div>

<div class="main">

<div class="cards">
  <div class="card">
    <div>üëÄ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
    <div class="big" id="onlineCount">0</div>
  </div>

  <div class="card">
    <div>üìà ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    <div class="big" id="totalViews">0</div>
  </div>

  <div class="card">
    <div>üé¨ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
    <div class="big" id="totalAnime">0</div>
  </div>
</div>

<div class="panel">
  <h3>üìä ‡∏ß‡∏¥‡∏ß‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
  <canvas id="viewChart" height="100"></canvas>
</div>

<div class="panel">
  <h3>üèÜ Top 10</h3>
  <div id="topList"></div>
</div>

<div class="spam-box">
  <h3>‚ö† ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡πâ‡∏°</h3>
  <div id="spamCount">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
  <div id="spamUsers"></div>
  <button class="clear-btn" id="clearSpam">‡∏•‡πâ‡∏≤‡∏á Spam</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase,
  ref,
  onValue,
  remove
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "PROJECT",
  storageBucket: "PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ONLINE USERS + AUTO CLEAN */
onValue(ref(db,"onlineUsers"), snap=>{
  if(!snap.exists()){
    document.getElementById("onlineCount").textContent = 0;
    return;
  }

  const data = snap.val();
  const now = Date.now();
  let count = 0;

  Object.entries(data).forEach(([key,val])=>{
    if(now - val.time > 60000){
      remove(ref(db,"onlineUsers/"+key));
    }else{
      count++;
    }
  });

  document.getElementById("onlineCount").textContent = count;
});

/* TOTAL VIEWS */
onValue(ref(db,"stats/totalViews"), snap=>{
  document.getElementById("totalViews").textContent =
    snap.exists() ? snap.val() : 0;
});

/* TOTAL ANIME */
onValue(ref(db,"animeList"), snap=>{
  document.getElementById("totalAnime").textContent =
    snap.exists() ? Object.keys(snap.val()).length : 0;
});

/* CHART */
const ctx = document.getElementById("viewChart");
let chart = new Chart(ctx,{
  type:"line",
  data:{
    labels:[],
    datasets:[{
      label:"‡∏ß‡∏¥‡∏ß‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô",
      data:[],
      borderColor:"#22d3ee",
      fill:false
    }]
  }
});

onValue(ref(db,"stats/daily"), snap=>{
  if(!snap.exists()) return;

  const data = snap.val();
  chart.data.labels = Object.keys(data);
  chart.data.datasets[0].data = Object.values(data);
  chart.update();
});

/* TOP 10 */
onValue(ref(db,"animeViews"), snap=>{
  if(!snap.exists()) return;

  const arr = Object.entries(snap.val());
  arr.sort((a,b)=> b[1] - a[1]);

  const top10 = arr.slice(0,10);
  const max = top10[0] ? top10[0][1] : 1;

  const box = document.getElementById("topList");
  box.innerHTML = "";

  top10.forEach(([id,views],i)=>{
    const percent = (views/max)*100;

    box.innerHTML += `
      <div class="top-item">
        <div class="rank">#${i+1}</div>
        <div style="flex:1">
          <div style="font-weight:bold">${id}</div>
          <div style="font-size:13px;color:#94a3b8">${views} ‡∏ß‡∏¥‡∏ß</div>
          <div class="progress">
            <div style="width:${percent}%"></div>
          </div>
        </div>
      </div>
    `;
  });
});

/* SPAM SYSTEM */
onValue(ref(db,"security/spamCount"), snap=>{
  document.getElementById("spamCount").textContent =
    "‡∏û‡∏ö‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏á‡∏™‡∏±‡∏¢: "+(snap.val()||0)+" ‡∏Ñ‡∏ô";
});

onValue(ref(db,"security/spamUsers"), snap=>{
  const box = document.getElementById("spamUsers");
  box.innerHTML = "";

  if(!snap.exists()) return;

  Object.entries(snap.val()).forEach(([id,data])=>{
    const time = new Date(data.time).toLocaleString();
    box.innerHTML += `
      <div style="font-size:13px;margin-bottom:6px;">
        üß® ${id} <br>
        <span style="color:#94a3b8">${time}</span>
      </div>
    `;
  });
});

/* CLEAR SPAM */
document.getElementById("clearSpam").onclick = ()=>{
  if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Spam ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){
    remove(ref(db,"security"));
  }
};

</script>
</body>
</html>