<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AnimeFume Admin</title>

<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:system-ui;padding:16px}
h2{color:#00ffcc}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.card{background:#111;border:1px solid #222;border-radius:14px;padding:14px}
.section{margin-top:18px;background:#111;border:1px solid #222;border-radius:16px;padding:14px}
.item{background:#000;border:1px solid #222;border-radius:10px;padding:8px 10px;margin-bottom:6px;font-size:13px}
.new{border-color:#ff3b3b}
.small{font-size:12px;opacity:.7}
button{background:#ff3b3b;border:none;border-radius:8px;padding:4px 8px;color:#fff}
.restore{background:#00cfa8}
</style>
</head>

<body>

<h2>üìä AnimeFume Admin (‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°)</h2>

<div class="cards">
  <div class="card">üëÅÔ∏è ‡∏¢‡∏≠‡∏î‡∏î‡∏π‡∏£‡∏ß‡∏°<br><b id="totalViews">0</b></div>
  <div class="card">üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå<br><b id="onlineCount">0</b></div>
  <div class="card">üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ<br><b id="todayViews">0</b></div>
</div>

<div class="section">
  <h3>üü¢ ‡∏Ñ‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏à‡∏£‡∏¥‡∏á</h3>
  <div id="onlineList"></div>
</div>

<div class="section">
  <h3>üì¢ ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h3>
  <div id="reportList"></div>
</div>

<div class="section">
  <h3>üìö ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</h3>
  <div id="animeList"></div>
</div>

<div class="section">
  <h3>‚ôª ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô</h3>
  <div id="trashList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref, onValue, get, set, remove, update
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig={
  apiKey:"API_KEY",
  authDomain:"PROJECT.firebaseapp.com",
  databaseURL:"https://PROJECT.firebaseio.com",
  projectId:"PROJECT",
  appId:"APP_ID"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* ===== STATS (‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°) ===== */
onValue(ref(db,"stats/totalViews"),s=>totalViews.textContent=s.val()||0);
const today=new Date().toISOString().slice(0,10);
onValue(ref(db,"stats/daily/"+today),s=>todayViews.textContent=s.val()||0);

/* ===== ONLINE USERS (‡πÄ‡∏Ç‡πâ‡∏≤‚Äì‡∏≠‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á) ===== */
onValue(ref(db,"onlineUsers"),s=>{
  onlineList.innerHTML="";
  if(!s.exists()){
    onlineCount.textContent=0;
    onlineList.innerHTML="<div class='small'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>";
    return;
  }
  const data=s.val();
  onlineCount.textContent=Object.keys(data).length;
  Object.values(data).forEach(u=>{
    onlineList.innerHTML+=`
      <div class="item">
        üü¢ ${u.page}<br>
        <span class="small">${new Date(u.last).toLocaleTimeString()}</span>
      </div>`;
  });
});

/* ===== REPORTS ===== */
onValue(ref(db,"reports"),s=>{
  reportList.innerHTML="";
  if(!s.exists()) return reportList.innerHTML="‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤";
  s.forEach(c=>{
    const r=c.val();
    reportList.innerHTML+=`
      <div class="item ${r.read?"":"new"}"
       onclick="read('${c.key}')">
        <b>${r.page}</b>
        <div>${r.detail}</div>
        <span class="small">${r.time}</span>
      </div>`;
  });
});
window.read=id=>update(ref(db,"reports/"+id),{read:true});

/* ===== ANIME LIST (‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏à‡∏£‡∏¥‡∏á) ===== */
onValue(ref(db,"animeList"),s=>{
  animeList.innerHTML="";
  if(!s.exists()) return;
  s.forEach(c=>{
    animeList.innerHTML+=`
      <div class="item">
        ${c.val().title||c.key}
        <button onclick="hide('${c.key}')">‡∏ã‡πà‡∏≠‡∏ô</button>
      </div>`;
  });
});

onValue(ref(db,"hiddenAnime"),s=>{
  trashList.innerHTML="";
  if(!s.exists()) return;
  s.forEach(c=>{
    trashList.innerHTML+=`
      <div class="item">
        ${c.val().title||c.key}
        <button class="restore" onclick="restore('${c.key}')">‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤</button>
      </div>`;
  });
});

window.hide=async id=>{
  const s=await get(ref(db,"animeList/"+id));
  await set(ref(db,"hiddenAnime/"+id),s.val());
  await remove(ref(db,"animeList/"+id));
};
window.restore=async id=>{
  const s=await get(ref(db,"hiddenAnime/"+id));
  await set(ref(db,"animeList/"+id),s.val());
  await remove(ref(db,"hiddenAnime/"+id));
};
</script>

</body>
</html>