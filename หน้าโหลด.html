<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnimeFume</title>
<style>
/* ===== RESET ===== */
* { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin:0; padding:0; }
body { min-height:100vh; color:#333; }

/* ===== BACKGROUND ===== */
#bg { position:fixed; inset:0; background:url("https://wallpapers.com/images/hd/street-crossing-aesthetic-anime-scenery-l83ai5pxcgb259mv.jpg") center/cover no-repeat; z-index:-1; }

/* ===== HEADER ===== */
.header { position:sticky; top:0; z-index:10; background: rgba(255,255,255,0.7); backdrop-filter: blur(8px); padding:14px; text-align:center; border-bottom:1px solid #ddd;}
.header h1 { margin:0 0 10px; }
.search { width:90%; max-width:400px; padding:10px 14px; border-radius:20px; border:1px solid #ccc; outline:none; }

/* ===== LIST ===== */
.anime-list { padding:20px; display:grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap:16px; }

/* ===== CARD ===== */
.anime-card {
  text-decoration:none;
  color:#333;
  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(6px);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 8px 20px rgba(0,0,0,0.1);
  transition: transform .2s, box-shadow .2s;
  position:relative;
}
.anime-card:hover { transform: translateY(-4px); box-shadow:0 12px 30px rgba(0,0,0,0.15);}
.img-box { position:relative; }
.img-box img { width:100%; height:220px; object-fit:cover; }
.overlay-text { position:absolute; left:0; bottom:0; width:100%; padding:10px; font-size:13px; color:#fff; background:linear-gradient(to top, rgba(0,0,0,0.75), rgba(0,0,0,0.2), transparent); }

/* ===== PARTICLE ===== */
.particle { position:fixed; bottom:-20px; width:6px; height:6px; border-radius:50%; pointer-events:none; z-index:2;
  background: radial-gradient(circle, rgba(180,220,255,0.9), rgba(180,220,255,0.4), transparent);
  box-shadow:0 0 10px rgba(180,220,255,0.9), 0 0 20px rgba(150,200,255,0.6);
  animation: particleUp linear forwards;
}
@keyframes particleUp { from{transform:translateY(0) scale(0.6);opacity:0;} to{transform:translateY(-120vh) scale(1.4);opacity:1;} }

/* ===== MENU ===== */
#menuBtn { position:fixed; top:15px; left:15px; font-size:28px; color:#fff; cursor:pointer; z-index:1000; user-select:none; }
#menuDropdown { position:fixed; top:55px; left:15px; background:rgba(0,0,0,0.85); border-radius:8px; display:flex; flex-direction:column; padding:10px; z-index:999; transition:all 0.25s ease;}
#menuDropdown a { color:#fff; text-decoration:none; padding:8px 12px; font-size:16px; transition:0.2s;}
.hidden { display:none; }
</style>
</head>

<body>

<div id="bg"></div>

<header class="header">
  <h1>AnimeFume</h1>
  <input class="search" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞...">
  
  <div id="menuBtn">‚ò∞</div>
  <div id="menuDropdown" class="hidden">
    <a href="">‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡πÄ‡∏£‡∏Å</a>
    <a href="index2.html">‡∏ã‡∏±‡∏ö‡πÑ‡∏ó‡∏¢</a>
    <a href="index3.html">‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</a>
    <a href="Administrator.html">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡πÄ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</a>
  </div>
</header>

<section class="anime-list" id="animeList">

  <!-- ====== ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏ö ====== -->
  <a href="ByteWorld101.html" class="anime-card">
    <div class="img-box">
      <img src="https://kusuriyanohitorigoto.jp/season1/gallery/img/keyvisual/02.jpg">
      <div class="overlay-text">Mizu Zokusei no Mahoutsukai<br>‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1‚Äì24 ‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢ ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
    </div>
  </a>
  <a href="202.html" class="anime-card">
    <div class="img-box">
      <img src="https://anifume.com/images/18/Sword-Art-Online-1.jpg">
      <div class="overlay-text">Sword Art Online<br>‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1-25 ‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢ ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
    </div>
  </a>
  <a href="203.html" class="anime-card">
    <div class="img-box">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ3G46VISYTyNvhfCIRxvFe6KExkWlNdekrUg88tKYhZ7wA0NNXGmQg74rj&s=10">
      <div class="overlay-text">DAN DA DAN ‡∏î‡∏±‡∏ô‡∏î‡∏≤‡∏î‡∏±‡∏ô<br>‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1-12 ‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢ ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
    </div>
  </a>
</section>

<script src="firebase.js"></script>
<script>
// üë• ‡∏ú‡∏π‡πâ‡∏ä‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏à‡∏£‡∏¥‡∏á (‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ß‡πá‡∏ö)
const onlineRef = db.ref("onlineUsers");
const me = onlineRef.push(true);
me.onDisconnect().remove();

// üî¢ ‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏π‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ß‡πá‡∏ö
db.ref("views/total").transaction(v => (v||0)+1);

// üìÖ ‡∏ô‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
const day = new Date().toISOString().slice(0,10);
db.ref("daily/"+day).transaction(v => (v||0)+1);
/* ===============================
   LOAD ANIME CARD (‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤)
================================ */
fetch("episodes.json")
.then(res => res.json())
.then(data => {
  const box = document.getElementById("animeList");
  if(!box || !data || !data.anime) return;

  const poster = data.episodes[0]?.poster || 
    "https://via.placeholder.com/300x400?text=No+Image";

  const html = `
    <a href="watch.html?ep=1" class="anime-card">
      <div class="img-box">
        <img src="${poster}">
        <div class="overlay-text">
          ${data.animeTitle}<br>‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1‚Äì${data.episodes.length}
        </div>
      </div>
    </a>
  `;
  box.insertAdjacentHTML("afterbegin", html);
})
.catch(()=>{});

/* ===============================
   MENU
================================ */
const menuBtn = document.getElementById("menuBtn");
const menuDropdown = document.getElementById("menuDropdown");

if(menuBtn && menuDropdown){
  menuDropdown.style.display = "none";
  menuBtn.addEventListener("click", ()=>{
    menuDropdown.style.display =
      (menuDropdown.style.display === "none") ? "flex" : "none";
  });
}


/* ===============================
   PARALLAX
================================ */
const bg = document.getElementById("bg");
if(bg){
  window.addEventListener("scroll", ()=>{
    bg.style.transform = `translateY(${window.scrollY * 0.18}px)`;
  });
}


/* ===============================
   PARTICLE EFFECT
================================ */
function spawnParticle(){
  const p = document.createElement("div");
  p.className = "particle";
  p.style.left = Math.random() * 100 + "vw";
  p.style.animationDuration = (6 + Math.random() * 6) + "s";
  document.body.appendChild(p);
  setTimeout(()=>p.remove(), 12000);
}
setInterval(spawnParticle, 350);


/* ===============================
   VISITOR MONITOR (LOCAL)
   ‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / ‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô
================================ */

// Device ID (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
let deviceId = localStorage.getItem("device_id");
if(!deviceId){
  deviceId = "DEV-" + Math.random().toString(36).substr(2,8).toUpperCase();
  localStorage.setItem("device_id", deviceId);
}

// ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
let visitCount = parseInt(localStorage.getItem("visit_count") || "0", 10);
visitCount++;
localStorage.setItem("visit_count", visitCount);

// ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
const lastAccess = new Date().toLocaleString("th-TH");
localStorage.setItem("last_access", lastAccess);

// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ admin-box)
const stats = document.querySelectorAll(".stat .value");
if(stats.length >= 3){
  stats[0].textContent = visitCount;   // Total Visits (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)
  stats[1].textContent = "1";          // Unique Devices (local)
  stats[2].textContent = lastAccess;   // Last Access
}

// debug
console.log("Visitor Monitor ‚Üí", {
  deviceId,
  visitCount,
  lastAccess
});

</script>

</body>
</html>