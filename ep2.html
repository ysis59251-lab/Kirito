<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>DarkFrame</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  min-height:100vh;
  font-family:sans-serif;
  background:
    url("https://img.freepik.com/free-photo/anime-night-sky-illustration_23-2151684372.jpg")
    center / cover no-repeat fixed;
  color:#fff;
}

.container{
  max-width:720px;
  margin:auto;
  padding:12px;
}

.title{
  background:#fff;
  color:#000;
  padding:12px 16px;
  border-radius:12px;
  margin-bottom:10px;
  font-size:18px;
  font-weight:700;
}

.top-title{
  background:rgba(0,0,0,.85);
  color:#fff;
  padding:14px;
  border-radius:14px;
  text-align:center;
  margin-bottom:14px;
}

.stats{
  display:flex;
  justify-content:space-between;
  background:rgba(0,0,0,.7);
  padding:10px 14px;
  border-radius:12px;
  margin-bottom:14px;
  font-size:14px;
}

.player{
  background:#000;
  border-radius:14px;
  overflow:hidden;
}

.player video{
  width:100%;
  height:300px;
  object-fit:contain;
  background:#000;
}

.controls{
  display:flex;
  gap:10px;
  margin-top:14px;
}

.btn{
  flex:1;
  background:#1e1e1e;
  border:none;
  border-radius:12px;
  padding:12px;
  color:#fff;
  cursor:pointer;
}

.btn:hover{background:#ff4d4d}
.like{background:#ff4d4d}

.footer-support{
  margin:40px 16px 20px;
  padding:12px;
  text-align:center;
  font-size:.85rem;
  color:#222;
  background:#fff;
  border-radius:12px;
}
</style>
</head>

<body
  data-anime="DAN DA DAN"
  data-ep="2"
  data-total="12"
>

<div class="container">

  <div class="title">
    DAN DA DAN ‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà <span id="epShow">2</span>
  </div>

  <div class="top-title">
    ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ï‡∏≠‡∏ô 1‚Äì12 ‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢ ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß
  </div>

  <div class="stats">
    <div>üëÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π: <b id="watchingNow">0</b></div>
    <div>‚ù§Ô∏è ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à: <b id="likeCount">0</b></div>
  </div>

  <div class="player">
    <video id="videoPlayer" controls playsinline
      poster="https://pbs.twimg.com/media/DSJGh_9U8AAzf_Q.jpg">
      <source src="https://files.akuma-player.xyz/view/59405c86-b886-532e-8b8c-e25d2d17a812" type="video/mp4">
    </video>
  </div>

  <div class="controls">
    <button class="btn" onclick="prevEp()">‚¨Ö ‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <button class="btn like" onclick="likeAnime()">‚ù§Ô∏è ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à</button>
    <button class="btn" onclick="nextEp()">‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°</button>
  </div>

</div>

<div class="footer-support">
  ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
</div>

<!-- ===== FIREBASE ===== -->
<script src="firebase.js"></script>
<script>
/* ================= BASIC ================= */
const anime = document.body.dataset.anime;
const ep    = Number(document.body.dataset.ep);
const total = Number(document.body.dataset.total);
epShow.textContent = ep;

/* ================= LOCAL PROGRESS ================= */
let localDB = JSON.parse(localStorage.getItem("animeDB")) || {};
if(!localDB[anime]){
  localDB[anime] = { total, done: [] };
}
if(!localDB[anime].done.includes(ep)){
  localDB[anime].done.push(ep);
}
localStorage.setItem("animeDB", JSON.stringify(localDB));

/* ================= FIREBASE ================= */

// üëÄ ‡∏Ñ‡∏ô‡∏î‡∏π‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π (Realtime ‡∏à‡∏£‡∏¥‡∏á)
const watchRef = db.ref("watching/"+anime).push(true);
watchRef.onDisconnect().remove();

db.ref("watching/"+anime).on("value", s=>{
  watchingNow.textContent = s.numChildren();
});

// üî¢ ‡∏¢‡∏≠‡∏î‡∏î‡∏π‡∏™‡∏∞‡∏™‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ô‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤)
db.ref("views/anime/"+anime).transaction(v => (v||0)+1);

// ‚ù§Ô∏è Like
function likeAnime(){
  db.ref("likes/"+anime).transaction(v => (v||0)+1);
}

db.ref("likes/"+anime).on("value", s=>{
  likeCount.textContent = s.val() || 0;
});

/* ================= CHANGE EP ================= */
function prevEp(){
  if(ep<=1) return alert("‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
  location.href = `?ep=${ep-1}`;
}

function nextEp(){
  if(ep>=total) return alert("‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
  location.href = `?ep=${ep+1}`;
}
</script>

</body>
</html>