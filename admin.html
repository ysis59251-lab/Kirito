<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AnimeFume Admin</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:system-ui;padding:16px}
h2,h3{color:#00ffcc}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.card{background:#111;padding:14px;border-radius:14px;border:1px solid #222}
.section{margin-top:20px;background:#111;padding:16px;border-radius:16px;border:1px solid #222}

.report{background:#000;border:1px solid #222;border-radius:10px;padding:10px;margin-bottom:8px;font-size:13px}
button{background:#ff3b3b;border:none;padding:6px 12px;border-radius:8px;color:#fff;cursor:pointer}
button.restore{background:#00cfa8}

/* floating admin menu */
#adminBtn{
  position:fixed;bottom:20px;right:20px;
  width:56px;height:56px;border-radius:50%;
  background:#00ffcc;color:#000;
  display:flex;align-items:center;justify-content:center;
  font-size:24px;cursor:pointer;z-index:99
}
#adminPanel{
  position:fixed;bottom:90px;right:20px;
  width:320px;max-height:70vh;
  background:#111;border-radius:16px;
  padding:14px;display:none;overflow:auto;
  border:1px solid #222;z-index:99
}
</style>
</head>

<body>

<div id="adminBtn" onclick="toggleAdmin()">‚öôÔ∏è</div>

<div id="adminPanel">
  <h2>üìä Admin Dashboard</h2>

  <div class="cards">
    <div class="card">üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ<br><b id="onlineCount">0</b></div>
    <div class="card">üëÅ ‡∏¢‡∏≠‡∏î‡∏î‡∏π‡∏£‡∏ß‡∏°<br><b id="views">0</b></div>
    <div class="card">üìö ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î<br><b id="animeCount">0</b></div>
  </div>

  <div class="section">
    <h3>üìã ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</h3>
    <div id="animeList"></div>
  </div>

  <div class="section">
    <h3>üóë ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô</h3>
    <div id="hiddenList"></div>
  </div>

  <div class="section">
    <h3>üì¢ ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h3>
    <div id="reportList"></div>
  </div>

  <div class="section">
    <h3>üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏î‡∏π</h3>
    <canvas id="viewChart" height="120"></canvas>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref, onValue, onChildAdded,
  set, remove, get, update
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ===== FIREBASE ===== */
const firebaseConfig={
  apiKey:"API_KEY",
  authDomain:"PROJECT.firebaseapp.com",
  databaseURL:"https://PROJECT.firebaseio.com",
  projectId:"PROJECT",
  appId:"APP_ID"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* ===== UI ===== */
window.toggleAdmin=()=>{
  adminPanel.style.display =
    adminPanel.style.display==="block"?"none":"block";
};

/* ===== ONLINE USER ===== */
onValue(ref(db,"onlineUsers"),s=>{
  onlineCount.textContent = s.exists()
    ? Object.keys(s.val()).length : 0;
});

/* ===== VIEWS ===== */
onValue(ref(db,"animeViews"),s=>{
  views.textContent = s.val() || 0;
});

/* ===== ANIME LIST (‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°) ===== */
onValue(ref(db,"animeList"),s=>{
  animeList.innerHTML="";
  if(!s.exists()){
    animeList.innerHTML="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞";
    animeCount.textContent=0;
    return;
  }
  const data=s.val();
  animeCount.textContent=Object.keys(data).length;
  Object.entries(data).forEach(([id,a])=>{
    animeList.innerHTML+=`
      <div class="report">
        <b>${a.title}</b> (${a.ep||0} ‡∏ï‡∏≠‡∏ô)<br>
        <button onclick="hideAnime('${id}')">‡∏ã‡πà‡∏≠‡∏ô</button>
      </div>`;
  });
});

/* ===== HIDDEN ===== */
onValue(ref(db,"hiddenAnime"),s=>{
  hiddenList.innerHTML="";
  if(!s.exists()){
    hiddenList.innerHTML="‡∏ñ‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á";
    return;
  }
  Object.entries(s.val()).forEach(([id,a])=>{
    hiddenList.innerHTML+=`
      <div class="report">
        <b>${a.title}</b><br>
        <button class="restore"
          onclick="restoreAnime('${id}')">‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</button>
      </div>`;
  });
});

window.hideAnime=async id=>{
  const snap=await get(ref(db,"animeList/"+id));
  if(!snap.exists())return;
  await set(ref(db,"hiddenAnime/"+id),snap.val());
  await remove(ref(db,"animeList/"+id));
};

window.restoreAnime=async id=>{
  const snap=await get(ref(db,"hiddenAnime/"+id));
  if(!snap.exists())return;
  await set(ref(db,"animeList/"+id),snap.val());
  await remove(ref(db,"hiddenAnime/"+id));
};

/* ===== REPORT ===== */
onChildAdded(ref(db,"reports"),s=>{
  const r=s.val();
  reportList.innerHTML=`
    <div class="report">
      <small>${r.time||""}</small><br>
      <b>${r.page||""}</b>
      <p>${r.detail||""}</p>
    </div>`+reportList.innerHTML;
});

/* ===== CHART ===== */
let chart;
onValue(ref(db,"viewStats"),s=>{
  if(!s.exists())return;
  const d=s.val();
  const labels=Object.keys(d).sort();
  const values=labels.map(k=>d[k]);
  if(chart)chart.destroy();
  chart=new Chart(viewChart,{
    type:"line",
    data:{labels,datasets:[{
      data:values,
      borderColor:"#00ffcc",
      backgroundColor:"rgba(0,255,204,.15)",
      fill:true,tension:.35
    }]},
    options:{plugins:{legend:{display:false}}}
  });
});
</script>
</body>
</html>