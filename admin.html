<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AnimeFume Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#0b0b0b;color:#fff;font-family:system-ui;padding:16px}
h2{color:#00ffcc}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.card{background:#111;padding:14px;border-radius:12px;border:1px solid #222}
.section{margin-top:20px;background:#111;padding:16px;border-radius:14px;border:1px solid #222}

/* inbox */
#mailBox{position:fixed;top:16px;right:16px;width:48px;height:48px;background:#ff3b3b;
border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer}
#mailCount{position:absolute;top:-6px;right:-6px;background:#000;font-size:11px;
padding:2px 6px;border-radius:10px}
#inbox{position:fixed;top:80px;right:16px;width:320px;max-height:420px;
background:#111;border-radius:14px;padding:12px;display:none;flex-direction:column;overflow:auto}
.report-item{background:#000;border:1px solid #222;border-radius:10px;
padding:8px;margin-bottom:8px;font-size:12px}
.report-item.new{border-color:#ff3b3b}
button{background:#ff3b3b;border:none;padding:6px 10px;border-radius:8px;color:#fff;cursor:pointer}
button.restore{background:#00cfa8}
</style>
</head>

<body>

<!-- inbox -->
<div id="mailBox" onclick="toggleInbox()">üì¢<span id="mailCount">0</span></div>
<div id="inbox">
  <h3>üì¨ ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h3>
  <div id="reportList"></div>
</div>

<h2>üìä AnimeFume Dashboard</h2>

<div class="cards">
  <div class="card">üëÅÔ∏è ‡∏¢‡∏≠‡∏î‡∏î‡∏π‡∏£‡∏ß‡∏°<br><b id="views">0</b></div>
  <div class="card">üìö ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î<br><b id="aCount">0</b></div>
</div>

<div class="section">
  <h3>üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏î‡∏π (‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)</h3>
  <canvas id="viewChart" height="120"></canvas>
</div>

<h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞</h2>
<div id="adminList"></div>

<div class="section">
  <h3>üóë ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô</h3>
  <div id="trashBox"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref, onValue, onChildAdded,
  update, set, remove, get
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ===== FIREBASE ===== */
const firebaseConfig={
  apiKey:"YOUR_API_KEY",
  authDomain:"YOUR_PROJECT.firebaseapp.com",
  databaseURL:"https://YOUR_PROJECT.firebaseio.com",
  projectId:"YOUR_PROJECT",
  appId:"APP_ID"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* ===== REPORT ===== */
const reports=[];
onChildAdded(ref(db,"reports"),s=>{
  reports.push({id:s.key,...s.val()});
  renderInbox();
});

window.toggleInbox=()=>{
  inbox.style.display=inbox.style.display==="flex"?"none":"flex";
};

window.markRead=id=>{
  update(ref(db,"reports/"+id),{read:true});
};

function renderInbox(){
  mailCount.textContent=reports.filter(r=>!r.read).length;
  reportList.innerHTML="";
  reports.slice().reverse().forEach(r=>{
    reportList.innerHTML+=`
      <div class="report-item ${r.read?"":"new"}"
        onclick="markRead('${r.id}')">
        <small>${r.time}</small><br>
        <small>${r.page}</small>
        <p>${r.detail}</p>
      </div>`;
  });
}

/* ===== STATS ===== */
onValue(ref(db,"animeViews"),s=>{
  views.textContent=s.val()||0;
});
onValue(ref(db,"animeList"),s=>{
  aCount.textContent=s.exists()?Object.keys(s.val()).length:0;
});

/* ===== ANIME LIST ===== */
onValue(ref(db,"animeList"),s=>{
  adminList.innerHTML="";
  if(!s.exists()) return adminList.innerHTML="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞";
  Object.entries(s.val()).forEach(([id,a])=>{
    adminList.innerHTML+=`
      <div class="report-item">
        <b>${a.title}</b> (${a.ep||0} ‡∏ï‡∏≠‡∏ô)<br>
        <button onclick="hideAnime('${id}')">üóë ‡∏ã‡πà‡∏≠‡∏ô</button>
      </div>`;
  });
});

onValue(ref(db,"hiddenAnime"),s=>{
  trashBox.innerHTML="";
  if(!s.exists()) return trashBox.innerHTML="‡∏ñ‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á";
  Object.entries(s.val()).forEach(([id,a])=>{
    trashBox.innerHTML+=`
      <div class="report-item">
        <b>${a.title}</b><br>
        <button class="restore"
          onclick="restoreAnime('${id}')">‚ôªÔ∏è ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</button>
      </div>`;
  });
});

window.hideAnime=async id=>{
  if(!confirm("‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏ô‡∏µ‡πâ?"))return;
  const snap=await get(ref(db,"animeList/"+id));
  if(!snap.exists())return;
  await set(ref(db,"hiddenAnime/"+id),snap.val());
  await remove(ref(db,"animeList/"+id));
};

window.restoreAnime=async id=>{
  if(!confirm("‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏ô‡∏µ‡πâ?"))return;
  const snap=await get(ref(db,"hiddenAnime/"+id));
  if(!snap.exists())return;
  await set(ref(db,"animeList/"+id),snap.val());
  await remove(ref(db,"hiddenAnime/"+id));
};

/* ===== VIEW CHART ===== */
const ctx=document.getElementById("viewChart");
let chart;
onValue(ref(db,"viewStats"),s=>{
  if(!s.exists())return;
  const data=s.val();
  const labels=Object.keys(data).sort();
  const values=labels.map(d=>data[d]);
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:"line",
    data:{labels,datasets:[{
      data:values,label:"‡∏¢‡∏≠‡∏î‡∏î‡∏π",
      borderColor:"#00ffcc",
      backgroundColor:"rgba(0,255,204,.15)",
      tension:.35,fill:true
    }]},
    options:{plugins:{legend:{display:false}}}
  });
});
</script>

</body>
</html>